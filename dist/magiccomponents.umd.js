(function(i,r){typeof exports=="object"&&typeof module<"u"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(i=typeof globalThis<"u"?globalThis:i||self,r(i.magiccomponents={}))})(this,function(i){"use strict";var D=Object.defineProperty;var M=(i,r,m)=>r in i?D(i,r,{enumerable:!0,configurable:!0,writable:!0,value:m}):i[r]=m;var h=(i,r,m)=>M(i,typeof r!="symbol"?r+"":r,m);const r=[],m=({connected:e,disconnected:n},{allowShadowDom:o,stylecontent:t,whenVisible:a})=>{class c extends HTMLElement{constructor(){super();h(this,"shadow",null);h(this,"stylecontent",t);h(this,"allowShadowDom",o);h(this,"componentKey",null);h(this,"data",{});h(this,"whenVisibleAllowed",a);this.componentKey=this.getAttribute("data-key"),this.refreshProps=this.refreshProps.bind(this),this.sendData=this.sendData.bind(this)}connectedCallback(){var l;this.componentKey&&r.push(this.componentKey),((l=this.parentElement)==null?void 0:l.tagName)!=="TEMPLATE"&&(this.whenVisibleAllowed||this.render())}disconnectedCallBack(){n&&n({element:this})}attributeChangedCallback(s,l,u){if(u!=="true")return s;this.render()}render(){const s=b(this);this.allowShadowDom?(this.shadow=this.attachShadow({mode:"open"}),e({element:this.shadow,props:s,refreshProps:this.refreshProps,sendData:this.sendData,key:this.componentKey}),this.addStyle(this.shadow)):e({element:this,props:s,refreshProps:this.refreshProps,sendData:this.sendData,key:this.componentKey})}async refreshProps(s={},l=""){const{ajax:u}=(await import("htmx.org")).default;if(this.componentKey===null){console.warn("You must add the data-key attribute on each element");return}const g=document.createElement("template");g.id=this.componentKey;const y=document.body.appendChild(g),L=w(s,l),K=`[data-key='${this.componentKey}']`;return u("get",L,{target:`#${y.id}`,select:K,swap:"innerHTML"}).then(()=>{const p=y.firstElementChild;return p&&(this.data=b(p)),this.data}).then(p=>(y==null||y.remove(),p)).catch(p=>{console.error(p)})}async sendData(s,l){if(!customElements.get(s)){console.error(`The ${s} custom element has not been defined yet`);return}const u=document.querySelector(s),g=new CustomEvent("incoming_data",{detail:{bag:l}});u==null||u.dispatchEvent(g)}addStyle(s){if(this.stylecontent){const l=document.createElement("style");l.innerHTML=this.stylecontent,s.appendChild(l)}}}return h(c,"observedAttributes",["data-render"]),c},T=(e,n)=>{customElements.get(e)||customElements.define(e,n)},P=e=>{const n=e.reduce((t,a)=>(t[a]=(t[a]||0)+1,t),{});return Object.entries(n).filter(([t,a])=>a>1)},k=e=>{const n=P(e);if(n.length>0)for(const o of n){const[t]=o;throw new Error(`The key '${t}' already exists`)}},C=new IntersectionObserver((e,n)=>{var o;for(const t of e)t.isIntersecting&&((o=t==null?void 0:t.target)==null||o.setAttribute("data-render","true"),n.unobserve(t.target))}),O=async({tagname:e,allowShadowDom:n=!1,stylecontent:o="",whenVisible:t=!1},a,c=null)=>{const d=m({connected:a,disconnected:c},{allowShadowDom:n,stylecontent:o,whenVisible:t});if(T(e,d),k(r),t){const f=document.querySelectorAll(e);for(const s of f)C.observe(s)}},w=(e,n="")=>{const o=location.origin,t=location.pathname,a=Object.fromEntries(new URL(location.toString()).searchParams.entries());let c=`?${new URLSearchParams({...a,...e}).toString()}`,d=location.hash;return n.length>0&&(d=`#${n}`),`${o}${t}${c}${d}`},b=e=>{const n={...e.dataset},t=Object.entries(n).map(d=>{const[f,s]=d;try{return s?[f,JSON.parse(s)]:[f,s]}catch{return[f,s]}}),a=new Map(t);return a.set("tagname",e.tagName.toLowerCase()),Object.fromEntries(a)},S=async({loader:e})=>{if(e!=null&&e.enable){await Promise.resolve().then(()=>v);const n=document.createElement("magic-loader");n.setAttribute("data-color",e.color??"#639ef4"),document.body.append(n)}};class E extends HTMLElement{constructor(){super();h(this,"animationOne");h(this,"animationTwo")}async connectedCallback(){const{on:o}=(await import("htmx.org")).default,t=this.getAttribute("data-color")??"#639ef4";this.style.height="0.2rem",this.style.width="0",this.style.position="fixed",this.style.top="0",this.style.left="0",this.style.zIndex="9999",this.style.backgroundColor=t,this.style.display="none",o("htmx:beforeRequest",a=>{var d;const c=a;(d=c==null?void 0:c.detail)!=null&&d.boosted&&(this.style.display="block",this.animationOne=this.animate([{width:0},{width:"88%"}],{duration:7e3,fill:"forwards"}),this.animationOne.addEventListener("finish",()=>{this.animationTwo=this.animate([{width:"88%"},{width:"95%"}],{duration:5e3,iterations:1/0})}))})}disconnectedCallback(){var o,t;this.animationOne&&((o=this.animationOne)==null||o.cancel()),this.animationTwo&&((t=this.animationTwo)==null||t.cancel())}}customElements.define("magic-loader",E);const v=Object.freeze(Object.defineProperty({__proto__:null,MagicLoader:E},Symbol.toStringTag,{value:"Module"}));i.config=S,i.define=O,i.getPath=w,i.getProps=b,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});

(function(a,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("htmx.org")):typeof define=="function"&&define.amd?define(["exports","htmx.org"],o):(a=typeof globalThis<"u"?globalThis:a||self,o(a.magiccomponents={},a.htmx))})(this,function(a,o){"use strict";var P=Object.defineProperty;var R=(a,o,p)=>o in a?P(a,o,{enumerable:!0,configurable:!0,writable:!0,value:p}):a[o]=p;var u=(a,o,p)=>R(a,typeof o!="symbol"?o+"":o,p);const p=[],M=(t,e,s,n)=>{class i extends HTMLElement{constructor(){super();u(this,"shadow",null);u(this,"stylecontent",n);u(this,"allowShadowDom",s);u(this,"componentKey",null);u(this,"data",{});u(this,"magicData",{data:{},tagName:this.tagName.toLocaleLowerCase()});this.componentKey=this.getAttribute("data-key")}connectedCallback(){var d;this.componentKey&&p.push(this.componentKey),((d=this.parentElement)==null?void 0:d.tagName)!=="TEMPLATE"&&(this.magicData=E(this),this.allowShadowDom?(this.shadow=this.attachShadow({mode:"open"}),t({element:this.shadow}),this.addStyle(this.shadow)):t({element:this}))}disconnectedCallBack(){e&&e({element:this})}refreshMagicData(m={},d=""){const l=this.tagName.toLocaleLowerCase();if(this.componentKey===null){console.warn(`You must add the data-key attribute on each ${l}`);return}const h=document.createElement("template");h.id=l,document.body.appendChild(h);const c=v(m,d),g=`${l}[data-key='${this.componentKey}']`;return o.ajax("GET",c,{target:`#${l}`,select:g,swap:"innerHTML"}).then(()=>{const w=h.firstElementChild;return w&&(this.data=E(w)),this.data}).then(w=>(h.remove(),w)).catch(w=>{console.error(w)})}addStyle(m){if(this.stylecontent){const d=document.createElement("style");d.innerHTML=this.stylecontent,m.appendChild(d)}}}return i},C=(t,e)=>{customElements.get(t)||customElements.define(t,e)},S=t=>{const e=t.reduce((n,i)=>(n[i]=(n[i]||0)+1,n),{});return Object.entries(e).filter(([n,i])=>i>1)},L=t=>{const e=S(t);if(e.length>0)for(const s of e){const[n]=s;throw new Error(`The key '${n}' already exists`)}},b=t=>{if(t&&t.indexOf("<head")>-1){const e=document.createElement("html"),n=t.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"").match(/(<head(\s[^>]*>|>)([\s\S]*?)<\/head>)/im);if(n){const i=[],r=[],y=[],m=[];e.innerHTML=n.join(" ");const d=e.querySelector("head"),l=document.head,h=new Map;if(d==null)return;for(const c of d.children)h.set(c.outerHTML,c);for(const c of l.children)h.has(c.outerHTML)?(h.delete(c.outerHTML),y.push(c)):(o.trigger(document.body,"htmx:removingHeadElement",{headElement:c}),r.push(c));m.push(...h.values());for(const c of m){let g=document.createRange().createContextualFragment(c.outerHTML);o.trigger(document.body,"htmx:addingHeadElement",{headElement:g}),l.appendChild(g),i.push(g)}for(const c of r)o.trigger(document.body,"htmx:removingHeadElement",{headElement:c}),l.removeChild(c);o.trigger(document.body,"htmx:afterHeadMerge",{added:i,kept:y,removed:r})}}},k=()=>{o.on("htmx:afterSwap",function(t){const s=t.detail.xhr.response;b(s)}),o.on("htmx:historyRestore",function(t){const e=t;e.detail.cacheMiss?b(e.detail.serverResponse):b(e.detail.item.head)}),o.on("htmx:historyItemCreated",function(t){const s=t.detail.item;s.head=document.head.outerHTML})},O=async({tagname:t,allowShadowDom:e=!1,stylecontent:s=""},n,i=null)=>{const r=M(n,i,e,s);C(t,r),L(p)},v=(t,e="")=>{const s=location.origin,n=location.pathname,i=Object.fromEntries(new URL(location.toString()).searchParams.entries());let r=`?${new URLSearchParams({...i,...t}).toString()}`,y=location.hash;return e.length>0&&(y=`#${e}`),`${s}${n}${r}${y}`},E=t=>{var m;const e={...t.dataset},n=Object.entries(e).map(d=>{const[l,h]=d;try{return h?[l,JSON.parse(h)]:[l,h]}catch{return[l,h]}}),i=new Map(n),r=t.querySelector("template");if(r){const d=(m=r==null?void 0:r.content.textContent)==null?void 0:m.trim(),l=d?JSON.parse(d):{};i.set("data",l)}return i.set("tagName",t.tagName.toLowerCase()),Object.fromEntries(i)};let T=0,f=null;const N=async(t,e)=>{var n;if(o.config.refreshOnHistoryMiss===!1)return console.warn("Redirect is not enabled"),!1;const s=document.body;f&&(o.trigger(f,"htmx:abort",{}),(n=f.parentElement)==null||n.remove(),f=null),s.innerHTML+=`<span hx-disinherit="*" class='link-parent'> 
    <a class='bridge-redirect-link' href='${t}' hx-headers='${JSON.stringify(e)}' hx-boost='true' id='bridge-redirect-link-${T}'></a> 
  </span>`,o.process(document.body),f=s.querySelector(`.link-parent>#bridge-redirect-link-${T}`),f==null||f.click(),T++},$=async({redirect:t,loader:e,allowHeadSwap:s})=>{if(s&&k(),t&&(o.config.refreshOnHistoryMiss=!0),e!=null&&e.enable){await Promise.resolve().then(()=>x);const n=document.createElement("magic-loader");n.setAttribute("data-color",e.color??"#639ef4"),document.body.append(n)}};class H extends HTMLElement{constructor(){super();u(this,"animationOne");u(this,"animationTwo")}connectedCallback(){const s=this.getAttribute("data-color")??"#639ef4";this.style.height="0.2rem",this.style.width="0",this.style.position="fixed",this.style.top="0",this.style.left="0",this.style.zIndex="9999",this.style.backgroundColor=s,this.style.display="none",o.on("htmx:beforeRequest",n=>{var r;const i=n;(r=i==null?void 0:i.detail)!=null&&r.boosted&&(this.style.display="block",this.animationOne=this.animate([{width:0},{width:"88%"}],{duration:7e3,fill:"forwards"}),this.animationOne.addEventListener("finish",()=>{this.animationTwo=this.animate([{width:"88%"},{width:"95%"}],{duration:5e3,iterations:1/0})}))})}disconnectedCallback(){var s,n;this.animationOne&&((s=this.animationOne)==null||s.cancel()),this.animationTwo&&((n=this.animationTwo)==null||n.cancel())}}customElements.define("magic-loader",H);const x=Object.freeze(Object.defineProperty({__proto__:null,MagicLoader:H},Symbol.toStringTag,{value:"Module"}));a.config=$,a.define=O,a.getPath=v,a.getProps=E,a.redirect=N,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});

(function(t,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("dompurify")):typeof define=="function"&&define.amd?define(["exports","dompurify"],o):(t=typeof globalThis<"u"?globalThis:t||self,o(t.magiccomponents={},t.Dompurify))})(this,function(t,o){"use strict";var A=Object.defineProperty;var T=(t,o,a)=>o in t?A(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a;var d=(t,o,a)=>T(t,typeof o!="symbol"?o+"":o,a);const a=({connected:e},{allowShadowDom:n=!1,stylecontent:s,whenVisible:r=!1})=>{class l extends HTMLElement{constructor(){super();d(this,"stylecontent",s);d(this,"allowShadowDom",n);d(this,"disconnected",()=>{});d(this,"whenVisibleAllowed",r)}connectedCallback(){this.whenVisibleAllowed||this.render()}disconnectedCallback(){this.whenVisibleAllowed&&m.unobserve(this),this.disconnected()}attributeChangedCallback(i,c,f){i==="data-render"&&f==="true"&&this.render()}render(){const i=u(this);if(this.allowShadowDom){if(!this.shadowRoot){const c=this.attachShadow({mode:"open"});this.disconnected=e({element:c,props:i}),this.addSlotsTemplate(),this.addStyle(c)}}else this.disconnected=e({element:this,props:i})}addSlotsTemplate(){const c=`data-${this.tagName.toLowerCase().split("-")[0]}`,f=this.querySelector(`template[${c}]`);if(f){const S=f.content.querySelectorAll("[slot]"),y=new DocumentFragment;for(const v of S)y.append(v);const E=o.sanitize(y,{RETURN_DOM_FRAGMENT:!0});this.appendChild(E)}}addStyle(i){if(this.stylecontent){const c=document.createElement("style");c.textContent=this.stylecontent,i.appendChild(c)}}}return d(l,"observedAttributes",["data-render"]),l},b=(e,n)=>{customElements.get(e)||customElements.define(e,n)},m=new IntersectionObserver((e,n)=>{var s;for(const r of e)r.isIntersecting&&((s=r==null?void 0:r.target)==null||s.setAttribute("data-render","true"),n.unobserve(r.target))});function w(e){try{const n=e&&JSON.parse(e);if(typeof n=="string"){const s=document.createElement("div");return s.textContent=n,s.innerHTML}return n}catch{return e}}function g(e){return Object.entries({...e.dataset}).map(([n,s])=>[n,w(s??"")])}const C=async({tagname:e,allowShadowDom:n=!1,stylecontent:s="",whenVisible:r=!1},l)=>{if(!e||typeof e!="string"||!/^[a-z][.0-9_a-z-]*-[.0-9_a-z-]+$/.test(e))throw new Error(`Invalid or missing tagname: "${e}". A valid custom element name must contain a hyphen.`);const p=a({connected:l},{allowShadowDom:n,stylecontent:s,whenVisible:r});if(b(e,p),r){const h=document.querySelectorAll(e);for(const i of h)m.observe(i)}},u=e=>{const n=g(e),s=new Map(n);return s.set("tagname",e.tagName.toLowerCase()),Object.fromEntries(s)};t.define=C,t.getProps=u,t.observer=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});

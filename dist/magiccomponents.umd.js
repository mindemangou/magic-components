(function(d,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(d=typeof globalThis<"u"?globalThis:d||self,h(d.magiccomponents={}))})(this,function(d){"use strict";var j=Object.defineProperty;var q=(d,h,g)=>h in d?j(d,h,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[h]=g;var u=(d,h,g)=>q(d,typeof h!="symbol"?h+"":h,g);const h=[],g=({connected:n,disconnected:t},{allowShadowDom:o,stylecontent:e,whenVisible:s})=>{class a extends HTMLElement{constructor(){super();u(this,"shadow",null);u(this,"stylecontent",e);u(this,"allowShadowDom",o);u(this,"componentKey",null);u(this,"data",{});u(this,"magicData",{data:{},tagName:this.tagName.toLocaleLowerCase()});u(this,"whenVisibleAllowed",s);this.componentKey=this.getAttribute("data-key")}connectedCallback(){var c;this.componentKey&&h.push(this.componentKey),((c=this.parentElement)==null?void 0:c.tagName)!=="TEMPLATE"&&(this.whenVisibleAllowed||this.render())}disconnectedCallBack(){t&&t({element:this})}attributeChangedCallback(l,c,m){if(m!=="true")return l;this.render()}render(){this.magicData=v(this),this.allowShadowDom?(this.shadow=this.attachShadow({mode:"open"}),n({element:this.shadow}),this.addStyle(this.shadow)):n({element:this})}async refreshMagicData(l={},c=""){const{ajax:m}=(await import("htmx.org")).default,f=this.tagName.toLocaleLowerCase();if(this.componentKey===null){console.warn(`You must add the data-key attribute on each ${f}`);return}const r=document.createElement("template");r.id=f,document.body.appendChild(r);const b=C(l,c),R=`${f}[data-key='${this.componentKey}']`;return m("get",b,{target:`#${f}`,select:R,swap:"innerHTML"}).then(()=>{const w=r.firstElementChild;return w&&(this.data=v(w)),this.data}).then(w=>(r.remove(),w)).catch(w=>{console.error(w)})}addStyle(l){if(this.stylecontent){const c=document.createElement("style");c.innerHTML=this.stylecontent,l.appendChild(c)}}}return u(a,"observedAttributes",["data-render"]),a},S=(n,t)=>{customElements.get(n)||customElements.define(n,t)},M=n=>{const t=n.reduce((e,s)=>(e[s]=(e[s]||0)+1,e),{});return Object.entries(t).filter(([e,s])=>s>1)},k=n=>{const t=M(n);if(t.length>0)for(const o of t){const[e]=o;throw new Error(`The key '${e}' already exists`)}},E=async(n,t)=>{if(n&&n.indexOf("<head")>-1){const o=document.createElement("html"),s=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"").match(/(<head(\s[^>]*>|>)([\s\S]*?)<\/head>)/im);if(s){const a=[],i=[],y=[],l=[];o.innerHTML=s.join(" ");const c=o.querySelector("head"),m=document.head,f=new Map;if(c==null)return;for(const r of c.children)f.set(r.outerHTML,r);for(const r of m.children)f.has(r.outerHTML)?(f.delete(r.outerHTML),y.push(r)):(t(document.body,"htmx:removingHeadElement",{headElement:r}),i.push(r));l.push(...f.values());for(const r of l){let b=document.createRange().createContextualFragment(r.outerHTML);t(document.body,"htmx:addingHeadElement",{headElement:b}),m.appendChild(b),a.push(b)}for(const r of i)t(document.body,"htmx:removingHeadElement",{headElement:r}),m.removeChild(r);t(document.body,"htmx:afterHeadMerge",{added:a,kept:y,removed:i})}}},L=async({on:n,trigger:t})=>{n("htmx:afterSwap",function(o){const s=o.detail.xhr.response;E(s,t)}),n("htmx:historyRestore",function(o){const e=o;e.detail.cacheMiss?E(e.detail.serverResponse,t):E(e.detail.item.head,t)}),n("htmx:historyItemCreated",function(o){const s=o.detail.item;s.head=document.head.outerHTML})},x=new IntersectionObserver((n,t)=>{var o;for(const e of n)e.isIntersecting&&((o=e==null?void 0:e.target)==null||o.setAttribute("data-render","true"),t.unobserve(e.target))}),O=async({tagname:n,allowShadowDom:t=!1,stylecontent:o="",whenVisible:e=!1},s,a=null)=>{const i=g({connected:s,disconnected:a},{allowShadowDom:t,stylecontent:o,whenVisible:e});if(S(n,i),k(h),e){const y=document.querySelectorAll(n);for(const l of y)x.observe(l)}},C=(n,t="")=>{const o=location.origin,e=location.pathname,s=Object.fromEntries(new URL(location.toString()).searchParams.entries());let a=`?${new URLSearchParams({...s,...n}).toString()}`,i=location.hash;return t.length>0&&(i=`#${t}`),`${o}${e}${a}${i}`},v=n=>{var y;const t={...n.dataset},e=Object.entries(t).map(l=>{const[c,m]=l;try{return m?[c,JSON.parse(m)]:[c,m]}catch{return[c,m]}}),s=new Map(e),a=n.querySelector("template");if(a){const l=(y=a==null?void 0:a.content.textContent)==null?void 0:y.trim(),c=l?JSON.parse(l):{};s.set("data",c)}return s.set("tagName",n.tagName.toLowerCase()),Object.fromEntries(s)};let T=0,p=null;const N=async(n,t)=>{var i;const{config:o,trigger:e,process:s}=(await import("htmx.org")).default;if(o.refreshOnHistoryMiss===!1)return console.warn("Redirect is not enabled"),!1;const a=document.body;p&&(e(p,"htmx:abort",{}),(i=p.parentElement)==null||i.remove(),p=null),a.innerHTML+=`<span hx-disinherit="*" class='link-parent'> 
    <a class='bridge-redirect-link' href='${n}' hx-headers='${JSON.stringify(t)}' hx-boost='true' id='bridge-redirect-link-${T}'></a> 
  </span>`,s(document.body),p=a.querySelector(`.link-parent>#bridge-redirect-link-${T}`),p==null||p.click(),T++},$=async({redirect:n,loader:t,allowHeadSwap:o})=>{const{on:e,trigger:s,config:a}=(await import("htmx.org")).default;if(o&&L({on:e,trigger:s}),n&&(a.refreshOnHistoryMiss=!0),t!=null&&t.enable){await Promise.resolve().then(()=>P);const i=document.createElement("magic-loader");i.setAttribute("data-color",t.color??"#639ef4"),document.body.append(i)}};class H extends HTMLElement{constructor(){super();u(this,"animationOne");u(this,"animationTwo")}async connectedCallback(){const{on:o}=(await import("htmx.org")).default,e=this.getAttribute("data-color")??"#639ef4";this.style.height="0.2rem",this.style.width="0",this.style.position="fixed",this.style.top="0",this.style.left="0",this.style.zIndex="9999",this.style.backgroundColor=e,this.style.display="none",o("htmx:beforeRequest",s=>{var i;const a=s;(i=a==null?void 0:a.detail)!=null&&i.boosted&&(this.style.display="block",this.animationOne=this.animate([{width:0},{width:"88%"}],{duration:7e3,fill:"forwards"}),this.animationOne.addEventListener("finish",()=>{this.animationTwo=this.animate([{width:"88%"},{width:"95%"}],{duration:5e3,iterations:1/0})}))})}disconnectedCallback(){var o,e;this.animationOne&&((o=this.animationOne)==null||o.cancel()),this.animationTwo&&((e=this.animationTwo)==null||e.cancel())}}customElements.define("magic-loader",H);const P=Object.freeze(Object.defineProperty({__proto__:null,MagicLoader:H},Symbol.toStringTag,{value:"Module"}));d.config=$,d.define=O,d.getPath=C,d.getProps=v,d.redirect=N,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});

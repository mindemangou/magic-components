(function(d,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("htmx.org")):typeof define=="function"&&define.amd?define(["exports","htmx.org"],s):(d=typeof globalThis<"u"?globalThis:d||self,s(d.magiccomponents={},d.htmx))})(this,function(d,s){"use strict";var R=Object.defineProperty;var j=(d,s,p)=>s in d?R(d,s,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[s]=p;var m=(d,s,p)=>j(d,typeof s!="symbol"?s+"":s,p);const p=[],H=(e,t,o,n,i)=>{class a extends HTMLElement{constructor(){super();m(this,"shadow",null);m(this,"stylecontent",n);m(this,"allowShadowDom",o);m(this,"componentKey",null);m(this,"data",{});m(this,"magicData",{data:{},tagName:this.tagName.toLocaleLowerCase()});m(this,"whenVisibleAllowed",i);this.componentKey=this.getAttribute("data-key")}connectedCallback(){var c;this.componentKey&&p.push(this.componentKey),((c=this.parentElement)==null?void 0:c.tagName)!=="TEMPLATE"&&(this.whenVisibleAllowed||this.render())}disconnectedCallBack(){t&&t({element:this})}attributeChangedCallback(l,c,h){if(h!=="true")return l;this.render()}render(){this.magicData=E(this),this.allowShadowDom?(this.shadow=this.attachShadow({mode:"open"}),e({element:this.shadow}),this.addStyle(this.shadow)):e({element:this})}refreshMagicData(l={},c=""){const h=this.tagName.toLocaleLowerCase();if(this.componentKey===null){console.warn(`You must add the data-key attribute on each ${h}`);return}const r=document.createElement("template");r.id=h,document.body.appendChild(r);const y=T(l,c),P=`${h}[data-key='${this.componentKey}']`;return s.ajax("get",y,{target:`#${h}`,select:P,swap:"innerHTML"}).then(()=>{const b=r.firstElementChild;return b&&(this.data=E(b)),this.data}).then(b=>(r.remove(),b)).catch(b=>{console.error(b)})}addStyle(l){if(this.stylecontent){const c=document.createElement("style");c.innerHTML=this.stylecontent,l.appendChild(c)}}}return m(a,"observedAttributes",["data-render"]),a},S=(e,t)=>{customElements.get(e)||customElements.define(e,t)},M=e=>{const t=e.reduce((n,i)=>(n[i]=(n[i]||0)+1,n),{});return Object.entries(t).filter(([n,i])=>i>1)},k=e=>{const t=M(e);if(t.length>0)for(const o of t){const[n]=o;throw new Error(`The key '${n}' already exists`)}},w=e=>{if(e&&e.indexOf("<head")>-1){const t=document.createElement("html"),n=e.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"").match(/(<head(\s[^>]*>|>)([\s\S]*?)<\/head>)/im);if(n){const i=[],a=[],u=[],g=[];t.innerHTML=n.join(" ");const l=t.querySelector("head"),c=document.head,h=new Map;if(l==null)return;for(const r of l.children)h.set(r.outerHTML,r);for(const r of c.children)h.has(r.outerHTML)?(h.delete(r.outerHTML),u.push(r)):(s.trigger(document.body,"htmx:removingHeadElement",{headElement:r}),a.push(r));g.push(...h.values());for(const r of g){let y=document.createRange().createContextualFragment(r.outerHTML);s.trigger(document.body,"htmx:addingHeadElement",{headElement:y}),c.appendChild(y),i.push(y)}for(const r of a)s.trigger(document.body,"htmx:removingHeadElement",{headElement:r}),c.removeChild(r);s.trigger(document.body,"htmx:afterHeadMerge",{added:i,kept:u,removed:a})}}},L=()=>{s.on("htmx:afterSwap",function(e){const o=e.detail.xhr.response;w(o)}),s.on("htmx:historyRestore",function(e){const t=e;t.detail.cacheMiss?w(t.detail.serverResponse):w(t.detail.item.head)}),s.on("htmx:historyItemCreated",function(e){const o=e.detail.item;o.head=document.head.outerHTML})},O=new IntersectionObserver((e,t)=>{var o;console.log("first");for(const n of e)n.isIntersecting&&((o=n==null?void 0:n.target)==null||o.setAttribute("data-render","true"),t.unobserve(n.target))}),N=async({tagname:e,allowShadowDom:t=!1,stylecontent:o="",whenVisible:n=!1},i,a=null)=>{const u=H(i,a,t,o,n);if(S(e,u),k(p),n){const g=document.querySelectorAll(e);for(const l of g)O.observe(l)}},T=(e,t="")=>{const o=location.origin,n=location.pathname,i=Object.fromEntries(new URL(location.toString()).searchParams.entries());let a=`?${new URLSearchParams({...i,...e}).toString()}`,u=location.hash;return t.length>0&&(u=`#${t}`),`${o}${n}${a}${u}`},E=e=>{var g;const t={...e.dataset},n=Object.entries(t).map(l=>{const[c,h]=l;try{return h?[c,JSON.parse(h)]:[c,h]}catch{return[c,h]}}),i=new Map(n),a=e.querySelector("template");if(a){const l=(g=a==null?void 0:a.content.textContent)==null?void 0:g.trim(),c=l?JSON.parse(l):{};i.set("data",c)}return i.set("tagName",e.tagName.toLowerCase()),Object.fromEntries(i)};let v=0,f=null;const $=async(e,t)=>{var n;if(s.config.refreshOnHistoryMiss===!1)return console.warn("Redirect is not enabled"),!1;const o=document.body;f&&(s.trigger(f,"htmx:abort",{}),(n=f.parentElement)==null||n.remove(),f=null),o.innerHTML+=`<span hx-disinherit="*" class='link-parent'> 
    <a class='bridge-redirect-link' href='${e}' hx-headers='${JSON.stringify(t)}' hx-boost='true' id='bridge-redirect-link-${v}'></a> 
  </span>`,s.process(document.body),f=o.querySelector(`.link-parent>#bridge-redirect-link-${v}`),f==null||f.click(),v++},q=async({redirect:e,loader:t,allowHeadSwap:o})=>{if(o&&L(),e&&(s.config.refreshOnHistoryMiss=!0),t!=null&&t.enable){await Promise.resolve().then(()=>x);const n=document.createElement("magic-loader");n.setAttribute("data-color",t.color??"#639ef4"),document.body.append(n)}};class C extends HTMLElement{constructor(){super();m(this,"animationOne");m(this,"animationTwo")}connectedCallback(){const o=this.getAttribute("data-color")??"#639ef4";this.style.height="0.2rem",this.style.width="0",this.style.position="fixed",this.style.top="0",this.style.left="0",this.style.zIndex="9999",this.style.backgroundColor=o,this.style.display="none",s.on("htmx:beforeRequest",n=>{var a;const i=n;(a=i==null?void 0:i.detail)!=null&&a.boosted&&(this.style.display="block",this.animationOne=this.animate([{width:0},{width:"88%"}],{duration:7e3,fill:"forwards"}),this.animationOne.addEventListener("finish",()=>{this.animationTwo=this.animate([{width:"88%"},{width:"95%"}],{duration:5e3,iterations:1/0})}))})}disconnectedCallback(){var o,n;this.animationOne&&((o=this.animationOne)==null||o.cancel()),this.animationTwo&&((n=this.animationTwo)==null||n.cancel())}}customElements.define("magic-loader",C);const x=Object.freeze(Object.defineProperty({__proto__:null,MagicLoader:C},Symbol.toStringTag,{value:"Module"}));d.config=q,d.define=N,d.getPath=T,d.getProps=E,d.redirect=$,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});

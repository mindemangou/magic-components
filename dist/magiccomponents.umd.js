(function(t,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("dompurify")):typeof define=="function"&&define.amd?define(["exports","dompurify"],o):(t=typeof globalThis<"u"?globalThis:t||self,o(t.magiccomponents={},t.Dompurify))})(this,function(t,o){"use strict";var v=Object.defineProperty;var A=(t,o,a)=>o in t?v(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a;var d=(t,o,a)=>A(t,typeof o!="symbol"?o+"":o,a);const a=({connected:e},{allowShadowDom:n=!1,stylecontent:s,whenVisible:r=!1})=>{class l extends HTMLElement{constructor(){super();d(this,"stylecontent",s);d(this,"allowShadowDom",n);d(this,"disconnected",()=>{});d(this,"whenVisibleAllowed",r)}connectedCallback(){this.whenVisibleAllowed||this.render()}disconnectedCallback(){this.whenVisibleAllowed&&f.unobserve(this),this.disconnected()}attributeChangedCallback(i,c,u){i==="data-render"&&u==="true"&&this.render()}render(){const i=m(this);if(this.allowShadowDom){if(!this.shadowRoot){const c=this.attachShadow({mode:"open"});this.disconnected=e({element:c,props:i}),this.addTemplateSlot(),this.addStyle(c)}}else this.disconnected=e({element:this,props:i})}addTemplateSlot(){const i=this.tagName.toLowerCase(),c=this.querySelector(`[data-for='${i}']`);if(c){const u=c.content.querySelectorAll("[slot]"),y=new DocumentFragment;for(const E of u)y.append(E);const S=o.sanitize(y,{RETURN_DOM_FRAGMENT:!0});this.appendChild(S)}}addStyle(i){if(this.stylecontent){const c=document.createElement("style");c.textContent=this.stylecontent,i.appendChild(c)}}}return d(l,"observedAttributes",["data-render"]),l},b=(e,n)=>{customElements.get(e)||customElements.define(e,n)},f=new IntersectionObserver((e,n)=>{var s;for(const r of e)r.isIntersecting&&((s=r==null?void 0:r.target)==null||s.setAttribute("data-render","true"),n.unobserve(r.target))});function w(e){try{const n=e&&JSON.parse(e);if(typeof n=="string"){const s=document.createElement("div");return s.textContent=n,s.innerHTML}return n}catch{return e}}function g(e){return Object.entries({...e.dataset}).map(([n,s])=>[n,w(s??"")])}const C=async({tagname:e,allowShadowDom:n=!1,stylecontent:s="",whenVisible:r=!1},l)=>{if(!e||typeof e!="string"||!/^[a-z][.0-9_a-z-]*-[.0-9_a-z-]+$/.test(e))throw new Error(`Invalid or missing tagname: "${e}". A valid custom element name must contain a hyphen.`);const h=a({connected:l},{allowShadowDom:n,stylecontent:s,whenVisible:r});if(b(e,h),r){const p=document.querySelectorAll(e);for(const i of p)f.observe(i)}},m=e=>{const n=g(e),s=new Map(n);return s.set("tagname",e.tagName.toLowerCase()),Object.fromEntries(s)};t.define=C,t.getProps=m,t.observer=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});

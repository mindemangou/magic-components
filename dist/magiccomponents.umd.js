(function(c,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("htmx.org")):typeof define=="function"&&define.amd?define(["exports","htmx.org"],o):(c=typeof globalThis<"u"?globalThis:c||self,o(c.magiccomponents={},c.htmx))})(this,function(c,o){"use strict";var R=Object.defineProperty;var j=(c,o,y)=>o in c?R(c,o,{enumerable:!0,configurable:!0,writable:!0,value:y}):c[o]=y;var m=(c,o,y)=>j(c,typeof o!="symbol"?o+"":o,y);const y=[],M=(t,e,s,n,i)=>{class d extends HTMLElement{constructor(){super();m(this,"shadow",null);m(this,"stylecontent",n);m(this,"allowShadowDom",s);m(this,"componentKey",null);m(this,"data",{});m(this,"magicData",{data:{},tagName:this.tagName.toLocaleLowerCase()});m(this,"whenVisibleAllowed",i);this.componentKey=this.getAttribute("data-key")}connectedCallback(){var r;this.componentKey&&y.push(this.componentKey),((r=this.parentElement)==null?void 0:r.tagName)!=="TEMPLATE"&&(this.magicData=E(this),this.allowShadowDom?(this.shadow=this.attachShadow({mode:"open"}),this.render(t,{element:this.shadow}),this.addStyle(this.shadow)):this.render(t,{element:this}))}disconnectedCallBack(){e&&e({element:this})}render(l,r){this.whenVisibleAllowed?new IntersectionObserver((a,p)=>{a[0].isIntersecting&&(l(r),p.unobserve(this))}).observe(this):l(r)}refreshMagicData(l={},r=""){const h=this.tagName.toLocaleLowerCase();if(this.componentKey===null){console.warn(`You must add the data-key attribute on each ${h}`);return}const a=document.createElement("template");a.id=h,document.body.appendChild(a);const p=T(l,r),P=`${h}[data-key='${this.componentKey}']`;return o.ajax("GET",p,{target:`#${h}`,select:P,swap:"innerHTML"}).then(()=>{const w=a.firstElementChild;return w&&(this.data=E(w)),this.data}).then(w=>(a.remove(),w)).catch(w=>{console.error(w)})}addStyle(l){if(this.stylecontent){const r=document.createElement("style");r.innerHTML=this.stylecontent,l.appendChild(r)}}}return d},C=(t,e)=>{customElements.get(t)||customElements.define(t,e)},S=t=>{const e=t.reduce((n,i)=>(n[i]=(n[i]||0)+1,n),{});return Object.entries(e).filter(([n,i])=>i>1)},L=t=>{const e=S(t);if(e.length>0)for(const s of e){const[n]=s;throw new Error(`The key '${n}' already exists`)}},b=t=>{if(t&&t.indexOf("<head")>-1){const e=document.createElement("html"),n=t.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"").match(/(<head(\s[^>]*>|>)([\s\S]*?)<\/head>)/im);if(n){const i=[],d=[],u=[],g=[];e.innerHTML=n.join(" ");const l=e.querySelector("head"),r=document.head,h=new Map;if(l==null)return;for(const a of l.children)h.set(a.outerHTML,a);for(const a of r.children)h.has(a.outerHTML)?(h.delete(a.outerHTML),u.push(a)):(o.trigger(document.body,"htmx:removingHeadElement",{headElement:a}),d.push(a));g.push(...h.values());for(const a of g){let p=document.createRange().createContextualFragment(a.outerHTML);o.trigger(document.body,"htmx:addingHeadElement",{headElement:p}),r.appendChild(p),i.push(p)}for(const a of d)o.trigger(document.body,"htmx:removingHeadElement",{headElement:a}),r.removeChild(a);o.trigger(document.body,"htmx:afterHeadMerge",{added:i,kept:u,removed:d})}}},k=()=>{o.on("htmx:afterSwap",function(t){const s=t.detail.xhr.response;b(s)}),o.on("htmx:historyRestore",function(t){const e=t;e.detail.cacheMiss?b(e.detail.serverResponse):b(e.detail.item.head)}),o.on("htmx:historyItemCreated",function(t){const s=t.detail.item;s.head=document.head.outerHTML})},O=async({tagname:t,allowShadowDom:e=!1,stylecontent:s="",whenVisible:n=!1},i,d=null)=>{const u=M(i,d,e,s,n);C(t,u),L(y)},T=(t,e="")=>{const s=location.origin,n=location.pathname,i=Object.fromEntries(new URL(location.toString()).searchParams.entries());let d=`?${new URLSearchParams({...i,...t}).toString()}`,u=location.hash;return e.length>0&&(u=`#${e}`),`${s}${n}${d}${u}`},E=t=>{var g;const e={...t.dataset},n=Object.entries(e).map(l=>{const[r,h]=l;try{return h?[r,JSON.parse(h)]:[r,h]}catch{return[r,h]}}),i=new Map(n),d=t.querySelector("template");if(d){const l=(g=d==null?void 0:d.content.textContent)==null?void 0:g.trim(),r=l?JSON.parse(l):{};i.set("data",r)}return i.set("tagName",t.tagName.toLowerCase()),Object.fromEntries(i)};let v=0,f=null;const N=async(t,e)=>{var n;if(o.config.refreshOnHistoryMiss===!1)return console.warn("Redirect is not enabled"),!1;const s=document.body;f&&(o.trigger(f,"htmx:abort",{}),(n=f.parentElement)==null||n.remove(),f=null),s.innerHTML+=`<span hx-disinherit="*" class='link-parent'> 
    <a class='bridge-redirect-link' href='${t}' hx-headers='${JSON.stringify(e)}' hx-boost='true' id='bridge-redirect-link-${v}'></a> 
  </span>`,o.process(document.body),f=s.querySelector(`.link-parent>#bridge-redirect-link-${v}`),f==null||f.click(),v++},$=async({redirect:t,loader:e,allowHeadSwap:s})=>{if(s&&k(),t&&(o.config.refreshOnHistoryMiss=!0),e!=null&&e.enable){await Promise.resolve().then(()=>x);const n=document.createElement("magic-loader");n.setAttribute("data-color",e.color??"#639ef4"),document.body.append(n)}};class H extends HTMLElement{constructor(){super();m(this,"animationOne");m(this,"animationTwo")}connectedCallback(){const s=this.getAttribute("data-color")??"#639ef4";this.style.height="0.2rem",this.style.width="0",this.style.position="fixed",this.style.top="0",this.style.left="0",this.style.zIndex="9999",this.style.backgroundColor=s,this.style.display="none",o.on("htmx:beforeRequest",n=>{var d;const i=n;(d=i==null?void 0:i.detail)!=null&&d.boosted&&(this.style.display="block",this.animationOne=this.animate([{width:0},{width:"88%"}],{duration:7e3,fill:"forwards"}),this.animationOne.addEventListener("finish",()=>{this.animationTwo=this.animate([{width:"88%"},{width:"95%"}],{duration:5e3,iterations:1/0})}))})}disconnectedCallback(){var s,n;this.animationOne&&((s=this.animationOne)==null||s.cancel()),this.animationTwo&&((n=this.animationTwo)==null||n.cancel())}}customElements.define("magic-loader",H);const x=Object.freeze(Object.defineProperty({__proto__:null,MagicLoader:H},Symbol.toStringTag,{value:"Module"}));c.config=$,c.define=O,c.getPath=T,c.getProps=E,c.redirect=N,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
